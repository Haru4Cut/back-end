name: Deploy

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2
      
    - name: Deploy with SSH
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.HOST }} 
        username: ${{ secrets.SSH_USERNAME }}  
        key: ${{ secrets.PRIVATE_KEY }} 
        port: ${{ secrets.PORT }}
        script: |
          cd /home/ubuntu/back-end
          pkill -f "java -jar haru4cut-0.0.1-SNAPSHOT.jar"          
          git pull
          ./gradlew clean build -x test
          cd build/libs
          nohup java -jar haru4cut-0.0.1-SNAPSHOT.jar &
